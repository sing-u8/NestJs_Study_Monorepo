---
description:
globs:
alwaysApply: true
---
use context7
use pnpm package manager

general implementation order: Domain â†’ Application â†’ Infrastructure â†’ Presentation

- actual hybrid implementation approach
Phase 1 - ê¸°ë°˜ ì„¤ì •:
1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (DB, JWT, Config)
2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
3. ê¸°ë³¸ ëª¨ë“ˆ êµ¬ì¡°
4. TypeORM ì—”í‹°í‹° (ìŠ¤í‚¤ë§ˆ ì •ì˜)

Phase 2 - ë„ë©”ì¸ í•µì‹¬:
5. ë„ë©”ì¸ ì—”í‹°í‹° & ê°’ ê°ì²´ ì •ì˜
6. ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤
7. ë„ë©”ì¸ ì˜ˆì™¸

Phase 3 - ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§:
8. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤
9. DTO ì •ì˜

Phase 4 - ì¸í”„ë¼ êµ¬í˜„:
10. ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´
11. ì™¸ë¶€ ì„œë¹„ìŠ¤ (JWT, ì†Œì…œ ë¡œê·¸ì¸)

Phase 5 - API ê³„ì¸µ:
12. ì»¨íŠ¸ë¡¤ëŸ¬
13. ê°€ë“œ & ë°ì½”ë ˆì´í„°
14. ì˜ˆì™¸ í•„í„°

- ë„ë©”ì¸ ì„¤ê³„
-- ë„ë©”ì¸ ì—”í‹°í‹°ì™€ ê°’ ê°ì²´ ì •ì˜
--  ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ êµ¬í˜„

- ê¸°ëŠ¥ë³„ ìˆ˜ì§ì  êµ¬í˜„
-- íšŒì›ê°€ì… API â†’ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ â†’ ë¦¬í¬ì§€í† ë¦¬ â†’ í…ŒìŠ¤íŠ¸


- auth-VC folder structure
apps/auth-vC/src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ app.module.ts
â”‚   â””â”€â”€ app.controller.ts
â”œâ”€â”€ auth/                              # Auth ë„ë©”ì¸ ë£¨íŠ¸
â”‚   â”œâ”€â”€ application/                   # ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ service/                  # ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ user.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ password.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ social-auth.service.ts
â”‚   â”‚   â”œâ”€â”€ dto/                       # ì• í”Œë¦¬ì¼€ì´ì…˜ DTO
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.dto.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ user.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ social-auth.dto.ts
â”‚   â”‚   â””â”€â”€ event/                    # ë„ë©”ì¸ ì´ë²¤íŠ¸
â”‚   â”‚       â”œâ”€â”€ handler/              # ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
â”‚   â”‚       â”‚   â”œâ”€â”€ user-registered.handler.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ user-logged-in.handler.ts
â”‚   â”‚       â”‚   â””â”€â”€ user-deleted.handler.ts
â”‚   â”‚       â””â”€â”€ event/                # ì´ë²¤íŠ¸ í´ë˜ìŠ¤
â”‚   â”‚           â”œâ”€â”€ user-registered.event.ts
â”‚   â”‚           â”œâ”€â”€ user-logged-in.event.ts
â”‚   â”‚           â””â”€â”€ user-deleted.event.ts
â”‚   â”œâ”€â”€ domain/                        # ë„ë©”ì¸ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ entity/                  # ë„ë©”ì¸ ì—”í‹°í‹°
â”‚   â”‚   â”‚   â”œâ”€â”€ user.entity.ts
â”‚   â”‚   â”‚   â””â”€â”€ refresh-token.entity.ts
â”‚   â”‚   â”œâ”€â”€ vo/             # ê°’ ê°ì²´
â”‚   â”‚   â”‚   â”œâ”€â”€ email.vo.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ password.vo.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ provider.vo.ts
â”‚   â”‚   â”‚   â””â”€â”€ user-id.vo.ts
â”‚   â”‚   â”œâ”€â”€ repository/              # ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ user.repository.interface.ts
â”‚   â”‚   â”‚   â””â”€â”€ refresh-token.repository.interface.ts
â”‚   â”‚   â”œâ”€â”€ service/                  # ë„ë©”ì¸ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ user.domain.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ password.domain.service.ts
â”‚   â”‚   â””â”€â”€ exception/                # ë„ë©”ì¸ ì˜ˆì™¸
â”‚   â”‚       â”œâ”€â”€ user-already-exists.exception.ts
â”‚   â”‚       â”œâ”€â”€ invalid-credentials.exception.ts
â”‚   â”‚       â”œâ”€â”€ user-not-found.exception.ts
â”‚   â”‚       â””â”€â”€ invalid-refresh-token.exception.ts
â”‚   â”œâ”€â”€ infrastructure/                # ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/              # TypeORM ì—”í‹°í‹°
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.typeorm.entity.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ refresh-token.typeorm.entity.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/          # ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.typeorm.repository.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ refresh-token.typeorm.repository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ migration/            # ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 1234567890-create-users-table.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ 1234567891-create-refresh-tokens-table.ts
â”‚   â”‚   â”‚   â””â”€â”€ seeds/                 # ì‹œë“œ ë°ì´í„°
â”‚   â”‚   â”‚       â””â”€â”€ user.seed.ts
â”‚   â”‚   â”œâ”€â”€ external-service/         # ì™¸ë¶€ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ google-auth.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ apple-auth.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ email.service.ts
â”‚   â”‚   â”œâ”€â”€ guard/                    # ê°€ë“œ
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt-auth.guard.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ refresh-token.guard.ts
â”‚   â”‚   â”‚   â””â”€â”€ optional-auth.guard.ts
â”‚   â”‚   â”œâ”€â”€ strategy/                # Passport ì „ëµ
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.strategy.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ refresh-token.strategy.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ google.strategy.ts
â”‚   â”‚   â”‚   â””â”€â”€ apple.strategy.ts
â”‚   â”‚   â””â”€â”€ config/                    # ì„¤ì •
â”‚   â”‚       â”œâ”€â”€ database.config.ts
â”‚   â”‚       â”œâ”€â”€ jwt.config.ts
â”‚   â”‚       â””â”€â”€ social-auth.config.ts
â”‚   â””â”€â”€ presentation/                  # í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ
â”‚       â”œâ”€â”€ controller/
â”‚       â”‚   â”œâ”€â”€ auth.controller.ts
â”‚       â”‚   â”œâ”€â”€ user.controller.ts
â”‚       â”‚   â””â”€â”€ social-auth.controller.ts
â”‚       â”œâ”€â”€ dto/                       # ìš”ì²­/ì‘ë‹µ DTO
â”‚       â”‚   â”œâ”€â”€ requests/
â”‚       â”‚   â”‚   â”œâ”€â”€ signup.request.dto.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ login.request.dto.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ refresh-token.request.dto.ts
â”‚       â”‚   â”‚   â””â”€â”€ social-login.request.dto.ts
â”‚       â”‚   â””â”€â”€ responses/
â”‚       â”‚       â”œâ”€â”€ auth.response.dto.ts
â”‚       â”‚       â”œâ”€â”€ user.response.dto.ts
â”‚       â”‚       â””â”€â”€ token.response.dto.ts
â”‚       â”œâ”€â”€ decorator/                # ì»¤ìŠ¤í…€ ë°ì½”ë ˆì´í„°
â”‚       â”‚   â”œâ”€â”€ current-user.decorator.ts
â”‚       â”‚   â”œâ”€â”€ public.decorator.ts
â”‚       â”‚   â””â”€â”€ roles.decorator.ts
â”‚       â”œâ”€â”€ filter/                   # ì˜ˆì™¸ í•„í„°
â”‚       â”‚   â”œâ”€â”€ auth-exception.filter.ts
â”‚       â”‚   â””â”€â”€ domain-exception.filter.ts
â”‚       â””â”€â”€ interceptor/              # ì¸í„°ì…‰í„°
â”‚           â”œâ”€â”€ response.interceptor.ts
â”‚           â””â”€â”€ logging.interceptor.ts
â”œâ”€â”€ shared/                            # ê³µí†µ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ interface/
â”‚   â”‚   â”œâ”€â”€ repository.interface.ts
â”‚   â”‚   â””â”€â”€ service.interface.ts
â”‚   â”œâ”€â”€ type/
â”‚   â”‚   â”œâ”€â”€ auth.types.ts
â”‚   â”‚   â””â”€â”€ common.types.ts
â”‚   â”œâ”€â”€ constant/
â”‚   â”‚   â”œâ”€â”€ auth.constants.ts
â”‚   â”‚   â””â”€â”€ app.constants.ts
â”‚   â”œâ”€â”€ util/
â”‚   â”‚   â”œâ”€â”€ hash.util.ts
â”‚   â”‚   â”œâ”€â”€ token.util.ts
â”‚   â”‚   â””â”€â”€ validation.util.ts
â”‚   â””â”€â”€ enum/
â”‚       â”œâ”€â”€ provider.enum.ts
â”‚       â””â”€â”€ user-status.enum.ts
â”œâ”€â”€ config/                            # ì „ì—­ ì„¤ì •
â”‚   â”œâ”€â”€ app.config.ts
â”‚   â”œâ”€â”€ database.config.ts
â”‚   â””â”€â”€ env.validation.ts
â””â”€â”€ main.ts



# êµ¬í˜„ ìƒí™©
# ğŸš€ NestJS Clean Architecture Auth System - Step 1 ì™„ë£Œ í˜„í™©

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

- **ëª©í‘œ**: NestJS + í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ì‚¬ìš©í•œ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„
- **ê¸°ëŠ¥**: íšŒì›ê°€ì…, ë¡œê·¸ì¸(ì¼ë°˜/ì†Œì…œ), ë¡œê·¸ì•„ì›ƒ, íšŒì›íƒˆí‡´
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL + TypeORM
- **ì•„í‚¤í…ì²˜**: CQRS ì—†ëŠ” í´ë¦° ì•„í‚¤í…ì²˜ (Domain â†’ Application â†’ Infrastructure â†’ Presentation)

## âœ… Phase 1: ê¸°ë°˜ ì„¤ì • ì™„ë£Œ ë‚´ì—­

### 1. í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ ì‹œìŠ¤í…œ

```typescript
// apps/auth-vC/src/config/env.validation.ts
- Joi ê¸°ë°˜ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ ìŠ¤í‚¤ë§ˆ
- TypeScript íƒ€ì… ì •ì˜ (EnvironmentVariables)
- í•„ìˆ˜/ì„ íƒ í™˜ê²½ ë³€ìˆ˜ êµ¬ë¶„
- ê°œë°œ/í”„ë¡œë•ì…˜ í™˜ê²½ êµ¬ë¶„
```

**í¬í•¨ëœ í™˜ê²½ ë³€ìˆ˜:**

- DATABASE\_\* (PostgreSQL ì—°ê²° ì •ë³´)
- JWT_SECRET, REFRESH_TOKEN_SECRET (í† í° ì‹œí¬ë¦¿)
- GOOGLE*\*, APPLE*\* (ì†Œì…œ ë¡œê·¸ì¸ ì„¤ì •)
- PORT, NODE_ENV (ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •)

### 2. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

```typescript
// apps/auth-vC/src/config/database.config.ts
- TypeORM ì„¤ì • íŒ©í† ë¦¬ (registerAs ì‚¬ìš©)
- PostgreSQL ì—°ê²° ì„¤ì •
- ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬
- ì—°ê²° í’€, SSL, ë¡œê¹… ì„¤ì •
- ì—”í‹°í‹° ìë™ ë¡œë”© ê²½ë¡œ ì„¤ì •
```

### 3. JWT í† í° ì‹œìŠ¤í…œ

```typescript
// apps/auth-vC/src/config/jwt.config.ts
- Access Token / Refresh Token ë¶„ë¦¬ ì„¤ì •
- í† í° í˜ì´ë¡œë“œ íƒ€ì… ì •ì˜ (JwtPayload, RefreshTokenPayload)
- NestJS JWT ëª¨ë“ˆ ì„¤ì •
- ë°œí–‰ì(issuer), ëŒ€ìƒ(audience) ì„¤ì •
```

### 4. TypeORM ì—”í‹°í‹° (ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ)

```typescript
// apps/auth-vC/src/auth/infrastructure/database/entity/

// user.typeorm.entity.ts
- ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´ (id, email, password_hash)
- ì†Œì…œ ë¡œê·¸ì¸ ì§€ì› (provider, provider_id)
- ê³„ì • ìƒíƒœ ê´€ë¦¬ (is_active, is_email_verified)
- í™œë™ ì¶”ì  (last_login_at, created_at, updated_at)
- ì¸ë±ìŠ¤ ìµœì í™” (ì´ë©”ì¼, ì†Œì…œë¡œê·¸ì¸ ì¡°íšŒ)

// refresh-token.typeorm.entity.ts
- ë¦¬í”„ë ˆì‹œ í† í° ê´€ë¦¬ (token, expires_at)
- ì‚¬ìš©ìì™€ 1:N ê´€ê³„ (CASCADE ì‚­ì œ)
- ë³´ì•ˆ ì¶”ì  (device_info, ip_address)
- í† í° ìƒíƒœ ê´€ë¦¬ (is_active, last_used_at)
- ë‹¤ì¤‘ ë””ë°”ì´ìŠ¤ ë¡œê·¸ì¸ ì§€ì›
```

### 5. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

```typescript
// apps/auth-vC/src/auth/infrastructure/database/migration/

// 1234567890-create-users-table.ts
- users í…Œì´ë¸” ìƒì„±
- ì¸ë±ìŠ¤ ì„¤ì • (ì´ë©”ì¼, ì†Œì…œë¡œê·¸ì¸, í™œì„±ìƒíƒœ, ìƒì„±ì¼)
- ì œì•½ì¡°ê±´ ì„¤ì •

// 1234567891-create-refresh-tokens-table.ts
- refresh_tokens í…Œì´ë¸” ìƒì„±
- ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ (users.id ì°¸ì¡°, CASCADE ì‚­ì œ)
- ë³µí•© ì¸ë±ìŠ¤ (ì‚¬ìš©ìë³„ í™œì„± í† í° ì¡°íšŒ ìµœì í™”)
- í† í° ë§Œë£Œ ì •ë¦¬ë¥¼ ìœ„í•œ ì¸ë±ìŠ¤
```

### 6. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •

```typescript
// apps/auth-vC/src/app/app.module.ts
- ConfigModule ì „ì—­ ì„¤ì • (Joi ê²€ì¦)
- TypeORM ëª¨ë“ˆ ì„¤ì • (ë¹„ë™ê¸° ì„¤ì •)
- JwtModule ì „ì—­ ì„¤ì •
- EventEmitterModule ì¤€ë¹„ (ì£¼ì„ ì²˜ë¦¬)

// apps/auth-vC/src/main.ts
- ValidationPipe ì „ì—­ ì„¤ì • (DTO ê²€ì¦)
- CORS ì„¤ì • (ê°œë°œ/í”„ë¡œë•ì…˜ êµ¬ë¶„)
- ê¸€ë¡œë²Œ í”„ë¦¬í”½ìŠ¤ (/api)
- ìš°ì•„í•œ ì¢…ë£Œ ì„¤ì •
```

## ğŸ“ í˜„ì¬ í´ë” êµ¬ì¡°

```
apps/auth-vC/src/
â”œâ”€â”€ config/                     # ì „ì—­ ì„¤ì •
â”‚   â”œâ”€â”€ env.validation.ts       âœ… í™˜ê²½ë³€ìˆ˜ ê²€ì¦
â”‚   â”œâ”€â”€ database.config.ts      âœ… DB ì„¤ì •
â”‚   â””â”€â”€ jwt.config.ts          âœ… JWT ì„¤ì •
â”œâ”€â”€ auth/
â”‚   â””â”€â”€ infrastructure/
â”‚       â””â”€â”€ database/
â”‚           â”œâ”€â”€ entity/       # TypeORM ì—”í‹°í‹°
â”‚           â”‚   â”œâ”€â”€ user.typeorm.entity.ts          âœ…
â”‚           â”‚   â””â”€â”€ refresh-token.typeorm.entity.ts âœ…
â”‚           â””â”€â”€ migration/     # DB ìŠ¤í‚¤ë§ˆ ë²„ì „ ê´€ë¦¬
â”‚               â”œâ”€â”€ 1234567890-create-users-table.ts        âœ…
â”‚               â””â”€â”€ 1234567891-create-refresh-tokens-table.ts âœ…
â”œâ”€â”€ app/
â”‚   â””â”€â”€ app.module.ts          âœ… ë£¨íŠ¸ ëª¨ë“ˆ (ì—…ë°ì´íŠ¸ë¨)
â””â”€â”€ main.ts                    âœ… ì• í”Œë¦¬ì¼€ì´ì…˜ ë¶€íŠ¸ìŠ¤íŠ¸ë©
```

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```sql
-- Users í…Œì´ë¸”
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255),                    -- ì†Œì…œ ë¡œê·¸ì¸ì‹œ NULL
  provider VARCHAR(50) DEFAULT 'local',          -- 'local', 'google', 'apple'
  provider_id VARCHAR(255),                      -- ì†Œì…œ ë¡œê·¸ì¸ ID
  is_active BOOLEAN DEFAULT true,
  is_email_verified BOOLEAN DEFAULT false,
  last_login_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Refresh Tokens í…Œì´ë¸”
CREATE TABLE refresh_tokens (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  token VARCHAR(255) UNIQUE NOT NULL,
  expires_at TIMESTAMP NOT NULL,
  device_info VARCHAR(255),                      -- ë””ë°”ì´ìŠ¤ ì¶”ì 
  ip_address VARCHAR(45),                        -- IPv6 ì§€ì›
  is_active BOOLEAN DEFAULT true,
  last_used_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ”§ í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ (.env)

```env
# ë°ì´í„°ë² ì´ìŠ¤
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=password
DATABASE_NAME=auth_db

# JWT (32ì ì´ìƒ ê¶Œì¥)
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-32chars
JWT_EXPIRES_IN=1h
REFRESH_TOKEN_SECRET=your-super-secret-refresh-token-key-change-this-in-production-32chars
REFRESH_TOKEN_EXPIRES_IN=7d

# ì†Œì…œ ë¡œê·¸ì¸ (ì„ íƒì‚¬í•­)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=http://localhost:3000/api/auth/google/callback

# ì• í”Œë¦¬ì¼€ì´ì…˜
PORT=3000
NODE_ENV=development
```

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ (Step 2: ë„ë©”ì¸ ê³„ì¸µ)

êµ¬í˜„ ì˜ˆì •:

1. **ë„ë©”ì¸ ì—”í‹°í‹° & ê°’ ê°ì²´**

   - `src/auth/domain/entity/user.entity.ts`
   - `src/auth/domain/vo/email.vo.ts`
   - `src/auth/domain/vo/password.vo.ts`
   - `src/auth/domain/vo/provider.vo.ts`

2. **ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤**

   - `src/auth/domain/repository/user.repository.interface.ts`
   - `src/auth/domain/repository/refresh-token.repository.interface.ts`

3. **ë„ë©”ì¸ ì˜ˆì™¸**
   - `src/auth/domain/exception/user-already-exists.exception.ts`
   - `src/auth/domain/exception/invalid-credentials.exception.ts`
   - `src/auth/domain/exception/user-not-found.exception.ts`

## ğŸ” í•µì‹¬ ì„¤ê³„ ì›ì¹™

1. **í´ë¦° ì•„í‚¤í…ì²˜**: ì˜ì¡´ì„± ì—­ì „, ê³„ì¸µ ë¶„ë¦¬
2. **íƒ€ì… ì•ˆì „ì„±**: TypeScript + Joi ê²€ì¦
3. **ë³´ì•ˆ**: JWT ë¶„ë¦¬, í™˜ê²½ë³€ìˆ˜ ê²€ì¦, í† í° ì¶”ì 
4. **í™•ì¥ì„±**: ì†Œì…œ ë¡œê·¸ì¸ ì§€ì›, ë‹¤ì¤‘ ë””ë°”ì´ìŠ¤
5. **ìœ ì§€ë³´ìˆ˜**: ë§ˆì´ê·¸ë ˆì´ì…˜, ì„¤ì • ë¶„ë¦¬, ë¬¸ì„œí™”



# ğŸ¯ NestJS Clean Architecture Auth System - Step 2 ì™„ë£Œ í˜„í™©

## ğŸ“‹ Step 2: ë„ë©”ì¸ ê³„ì¸µ êµ¬í˜„ ê°œìš”

- **ëª©í‘œ**: ë„ë©”ì¸ ì—”í‹°í‹°, ê°’ ê°ì²´, ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤, ë„ë©”ì¸ ì˜ˆì™¸ êµ¬í˜„
- **ì›ì¹™**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì¤‘ì‹¬, ì™¸ë¶€ ì˜ì¡´ì„± ì—†ëŠ” ìˆœìˆ˜í•œ ë„ë©”ì¸ ê·œì¹™
- **êµ¬ì¡°**: Entity â†’ Value Object â†’ Repository Interface â†’ Domain Service â†’ Exception

## âœ… Step 2: ë„ë©”ì¸ ê³„ì¸µ ì™„ë£Œ ë‚´ì—­

### 1. ê³µí†µ íƒ€ì… ë° ì—´ê±°í˜• (shared í´ë”)

```typescript
// apps/auth-vC/src/shared/enum/
- provider.enum.ts          âœ… ì¸ì¦ ì œê³µì ì—´ê±°í˜• (LOCAL, GOOGLE, APPLE)
- user-status.enum.ts       âœ… ì‚¬ìš©ì ìƒíƒœ ì—´ê±°í˜• (ACTIVE, INACTIVE, etc.)

// apps/auth-vC/src/shared/type/
- auth.types.ts             âœ… ì¸ì¦ ê´€ë ¨ íƒ€ì… ì •ì˜
- common.types.ts           âœ… ê³µí†µ ì¸í„°í˜ì´ìŠ¤ ë° íƒ€ì…
```

**ì£¼ìš” íŠ¹ì§•:**

- Provider ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ë¡œ ì œê³µì ê²€ì¦ ê¸°ëŠ¥
- UserStatus ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ë¡œ ìƒíƒœ ê´€ë¦¬ ê¸°ëŠ¥
- ë„ë©”ì¸ ì—”í‹°í‹°/ê°’ ê°ì²´ ê¸°ë³¸ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- í˜ì´ì§€ë„¤ì´ì…˜, ê²€ìƒ‰ ì˜µì…˜ íƒ€ì… ì •ì˜

### 2. ê°’ ê°ì²´ (Value Objects)

```typescript
// apps/auth-vC/src/auth/domain/vo/

// email.vo.ts                âœ… ì´ë©”ì¼ ê°’ ê°ì²´
- RFC 5321 í‘œì¤€ ì¤€ìˆ˜ (ìµœëŒ€ 254ì)
- ì´ë©”ì¼ í˜•ì‹ ê²€ì¦ (ì •ê·œì‹)
- ëŒ€ì†Œë¬¸ì ì •ê·œí™” ë° ê³µë°± ì œê±°
- ë„ë©”ì¸/ë¡œì»¬ ë¶€ë¶„ ì¶”ì¶œ ê¸°ëŠ¥

// password.vo.ts             âœ… ë¹„ë°€ë²ˆí˜¸ ê°’ ê°ì²´
- ë³µì¡ì„± ìš”êµ¬ì‚¬í•­ ê²€ì¦ (ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì)
- ìµœì†Œ/ìµœëŒ€ ê¸¸ì´ ì œí•œ (8-128ì)
- ì—°ì†ëœ ë™ì¼ ë¬¸ì ë°©ì§€
- ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ê³„ì‚° (1-5ì )

// provider.vo.ts             âœ… ì¸ì¦ ì œê³µì ê°’ ê°ì²´
- ì§€ì›ë˜ëŠ” ì œê³µìë§Œ í—ˆìš©
- ë¡œì»¬/ì†Œì…œ ì œê³µì êµ¬ë¶„ ê¸°ëŠ¥
- íŒ©í† ë¦¬ ë©”ì„œë“œ ì œê³µ

// user-id.vo.ts              âœ… ì‚¬ìš©ì ID ê°’ ê°ì²´
- UUID í˜•ì‹ ê²€ì¦
- ìƒˆ ID ìƒì„± ê¸°ëŠ¥
- ë¶ˆë³€ì„± ë³´ì¥
```

### 3. ë„ë©”ì¸ ì˜ˆì™¸ (Domain Exceptions)

```typescript
// apps/auth-vC/src/auth/domain/exception/

// domain.exception.ts              âœ… ë„ë©”ì¸ ì˜ˆì™¸ ê¸°ë³¸ í´ë˜ìŠ¤
- ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ê³µí†µ ì˜ˆì™¸ êµ¬ì¡° ì •ì˜
- ì—ëŸ¬ ì½”ë“œ, HTTP ìƒíƒœ ì½”ë“œ í¬í•¨
- JSON ì§ë ¬í™” ì§€ì›

// user-already-exists.exception.ts âœ… ì‚¬ìš©ì ì¤‘ë³µ ì˜ˆì™¸
- 409 ìƒíƒœ ì½”ë“œ
- ì´ë©”ì¼ ì •ë³´ í¬í•¨

// user-not-found.exception.ts      âœ… ì‚¬ìš©ì ë¯¸ë°œê²¬ ì˜ˆì™¸
- 404 ìƒíƒœ ì½”ë“œ
- ID/ì´ë©”ì¼ êµ¬ë¶„ ì§€ì›

// invalid-credentials.exception.ts âœ… ì˜ëª»ëœ ì¸ì¦ ì •ë³´ ì˜ˆì™¸
- 401 ìƒíƒœ ì½”ë“œ
- ë¡œê·¸ì¸ ì‹¤íŒ¨ ì²˜ë¦¬

// invalid-refresh-token.exception.ts âœ… ìœ íš¨í•˜ì§€ ì•Šì€ í† í° ì˜ˆì™¸
- 401 ìƒíƒœ ì½”ë“œ
- í† í° ì‹¤íŒ¨ ì´ìœ  í¬í•¨
```

### 4. ë„ë©”ì¸ ì—”í‹°í‹° (Domain Entities)

```typescript
// apps/auth-vC/src/auth/domain/entity/

// user.entity.ts               âœ… ì‚¬ìš©ì ë„ë©”ì¸ ì—”í‹°í‹°
- ë¡œì»¬/ì†Œì…œ ê³„ì • ìƒì„± íŒ©í† ë¦¬ ë©”ì„œë“œ
- ë³´ì•ˆ ê°•í™”: ì˜¤ì§ í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸ë§Œ ì €ì¥ ğŸ”’
- ì´ë©”ì¼ ì¸ì¦ ì²˜ë¦¬
- ê³„ì • ìƒíƒœ ê´€ë¦¬ (í™œì„±í™”/ë¹„í™œì„±í™”/ì •ì§€)
- ë¡œê·¸ì¸ ì‹œê°„ ì¶”ì 
- ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦

// refresh-token.entity.ts      âœ… ë¦¬í”„ë ˆì‹œ í† í° ë„ë©”ì¸ ì—”í‹°í‹°
- í† í° ë§Œë£Œ ê²€ì¦
- í† í° ì‚¬ìš© ê¸°ë¡ ê´€ë¦¬
- í† í° ê°±ì‹  ë¡œì§
- ë””ë°”ì´ìŠ¤ë³„ í† í° ê´€ë¦¬
- ë³´ì•ˆ ì¶”ì  ê¸°ëŠ¥
```

### 5. ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ (Repository Interfaces)

```typescript
// apps/auth-vC/src/auth/domain/repository/

// user.repository.interface.ts     âœ… ì‚¬ìš©ì ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤
- CRUD ê¸°ë³¸ operations
- ì´ë©”ì¼/ì†Œì…œ ë¡œê·¸ì¸ ì¡°íšŒ
- ì¡´ì¬ ì—¬ë¶€ í™•ì¸
- í˜ì´ì§€ë„¤ì´ì…˜ ì§€ì›
- ê²€ìƒ‰ ë° í•„í„°ë§
- ìƒíƒœ ì—…ë°ì´íŠ¸ ë©”ì„œë“œ

// refresh-token.repository.interface.ts âœ… ë¦¬í”„ë ˆì‹œ í† í° ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤
- í† í° CRUD operations
- ì‚¬ìš©ìë³„ í† í° ê´€ë¦¬
- ë””ë°”ì´ìŠ¤ë³„ í† í° ì¡°íšŒ
- ë§Œë£Œëœ í† í° ì •ë¦¬
- í† í° ì‚¬ìš© ì¶”ì 
- í† í° ê°œìˆ˜ ì œí•œ ì§€ì›
```

### 6. ë„ë©”ì¸ ì„œë¹„ìŠ¤ (Domain Services)

```typescript
// apps/auth-vC/src/auth/domain/service/

// user.domain.service.ts       âœ… ì‚¬ìš©ì ë„ë©”ì¸ ì„œë¹„ìŠ¤
- ë³µì¡í•œ ì‚¬ìš©ì ìƒì„± ë¡œì§
- ì´ë©”ì¼ ì¤‘ë³µ ê²€ì‚¬ (ë¡œì»¬/ì†Œì…œ í†µí•©)
- ì‚¬ìš©ì ì¸ì¦ ë¡œì§ (ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ê²€ì¦) ğŸ”’
- ê³„ì • ì—°ê²°/ë³‘í•© ë¡œì§
- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (í•´ì‹œ ì—…ë°ì´íŠ¸) ğŸ”’
- ê³„ì • ì‚­ì œ ì „ ê²€ì¦

// password.domain.service.ts   âœ… ë¹„ë°€ë²ˆí˜¸ ë„ë©”ì¸ ì„œë¹„ìŠ¤
- bcrypt ê¸°ë°˜ í•´ì‹± (salt + pepper)
- ë¹„ë°€ë²ˆí˜¸ ê°•ë„ í‰ê°€
- ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê²€ì¦
- ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ìƒì„±
- ë¹„ë°€ë²ˆí˜¸ ë§Œë£Œ ê´€ë¦¬
- ë³€ê²½ ì£¼ê¸° ì œí•œ
```

## ğŸ“ í˜„ì¬ í´ë” êµ¬ì¡° (Step 2 ì™„ë£Œ)

```
apps/auth-vC/src/
â”œâ”€â”€ shared/                          # ê³µí†µ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ enum/                        # ì—´ê±°í˜•
â”‚   â”‚   â”œâ”€â”€ provider.enum.ts         âœ… ì¸ì¦ ì œê³µì
â”‚   â”‚   â””â”€â”€ user-status.enum.ts      âœ… ì‚¬ìš©ì ìƒíƒœ
â”‚   â””â”€â”€ type/                        # íƒ€ì… ì •ì˜
â”‚       â”œâ”€â”€ auth.type.ts            âœ… ì¸ì¦ ê´€ë ¨ íƒ€ì…
â”‚       â””â”€â”€ common.type.ts          âœ… ê³µí†µ íƒ€ì…
â”œâ”€â”€ auth/                            # Auth ë„ë©”ì¸ ë£¨íŠ¸
â”‚   â”œâ”€â”€ domain/                      # ë„ë©”ì¸ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ entity/                  # ë„ë©”ì¸ ì—”í‹°í‹°
â”‚   â”‚   â”‚   â”œâ”€â”€ user.entity.ts       âœ… ì‚¬ìš©ì ì—”í‹°í‹°
â”‚   â”‚   â”‚   â”œâ”€â”€ refresh-token.entity.ts âœ… ë¦¬í”„ë ˆì‹œ í† í° ì—”í‹°í‹°
â”‚   â”‚   â”‚   â””â”€â”€ index.ts             âœ… ì—”í‹°í‹° export
â”‚   â”‚   â”œâ”€â”€ vo/                      # ê°’ ê°ì²´
â”‚   â”‚   â”‚   â”œâ”€â”€ email.vo.ts          âœ… ì´ë©”ì¼ ê°’ ê°ì²´
â”‚   â”‚   â”‚   â”œâ”€â”€ password.vo.ts       âœ… ë¹„ë°€ë²ˆí˜¸ ê°’ ê°ì²´
â”‚   â”‚   â”‚   â”œâ”€â”€ provider.vo.ts       âœ… ì œê³µì ê°’ ê°ì²´
â”‚   â”‚   â”‚   â”œâ”€â”€ user-id.vo.ts        âœ… ì‚¬ìš©ì ID ê°’ ê°ì²´
â”‚   â”‚   â”‚   â””â”€â”€ index.ts             âœ… ê°’ ê°ì²´ export
â”‚   â”‚   â”œâ”€â”€ repository/              # ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ user.repository.interface.ts         âœ… ì‚¬ìš©ì ë¦¬í¬ì§€í† ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ refresh-token.repository.interface.ts âœ… í† í° ë¦¬í¬ì§€í† ë¦¬
â”‚   â”‚   â”‚   â””â”€â”€ index.ts             âœ… ë¦¬í¬ì§€í† ë¦¬ export
â”‚   â”‚   â”œâ”€â”€ service/                 # ë„ë©”ì¸ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ user.domain.service.ts      âœ… ì‚¬ìš©ì ë„ë©”ì¸ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ password.domain.service.ts  âœ… ë¹„ë°€ë²ˆí˜¸ ë„ë©”ì¸ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â””â”€â”€ index.ts             âœ… ì„œë¹„ìŠ¤ export
â”‚   â”‚   â”œâ”€â”€ exception/               # ë„ë©”ì¸ ì˜ˆì™¸
â”‚   â”‚   â”‚   â”œâ”€â”€ domain.exception.ts  âœ… ê¸°ë³¸ ë„ë©”ì¸ ì˜ˆì™¸
â”‚   â”‚   â”‚   â”œâ”€â”€ user-already-exists.exception.ts     âœ… ì‚¬ìš©ì ì¤‘ë³µ ì˜ˆì™¸
â”‚   â”‚   â”‚   â”œâ”€â”€ user-not-found.exception.ts          âœ… ì‚¬ìš©ì ë¯¸ë°œê²¬ ì˜ˆì™¸
â”‚   â”‚   â”‚   â”œâ”€â”€ invalid-credentials.exception.ts     âœ… ì˜ëª»ëœ ì¸ì¦ ì •ë³´ ì˜ˆì™¸
â”‚   â”‚   â”‚   â”œâ”€â”€ invalid-refresh-token.exception.ts   âœ… ìœ íš¨í•˜ì§€ ì•Šì€ í† í° ì˜ˆì™¸
â”‚   â”‚   â”‚   â””â”€â”€ index.ts             âœ… ì˜ˆì™¸ export
â”‚   â”‚   â””â”€â”€ index.ts                 âœ… ë„ë©”ì¸ ê³„ì¸µ ì „ì²´ export
â”‚   â””â”€â”€ infrastructure/              # ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ (Step 1 ì™„ë£Œ)
â”‚       â””â”€â”€ database/
â”‚           â”œâ”€â”€ entity/            # TypeORM ì—”í‹°í‹°
â”‚           â””â”€â”€ migration/          # DB ë§ˆì´ê·¸ë ˆì´ì…˜
â”œâ”€â”€ config/                          # ì „ì—­ ì„¤ì • (Step 1 ì™„ë£Œ)
â””â”€â”€ app/                             # ì• í”Œë¦¬ì¼€ì´ì…˜ ë£¨íŠ¸
```

## ğŸ” ë„ë©”ì¸ ê³„ì¸µ í•µì‹¬ íŠ¹ì§•

### 1. ìˆœìˆ˜ì„± (Purity)

- ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ (NestJS ë°ì½”ë ˆì´í„° ì œì™¸)
- í”„ë ˆì„ì›Œí¬ ë…ë¦½ì ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°

### 2. ë¶ˆë³€ì„± (Immutability)

- ê°’ ê°ì²´ëŠ” ìƒì„± í›„ ë³€ê²½ ë¶ˆê°€
- ì—”í‹°í‹° ìƒíƒœ ë³€ê²½ì€ ë©”ì„œë“œë¥¼ í†µí•´ì„œë§Œ

### 3. íƒ€ì… ì•ˆì „ì„± (Type Safety)

- ì›ì‹œ íƒ€ì… ëŒ€ì‹  ê°’ ê°ì²´ ì‚¬ìš©
- ì»´íŒŒì¼ íƒ€ì„ íƒ€ì… ê²€ì¦
- ëŸ°íƒ€ì„ ìœ íš¨ì„± ê²€ì¦

### 4. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ì¤‘ì‹¬

- ë„ë©”ì¸ ì—”í‹°í‹°ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì§‘ì¤‘
- ë„ë©”ì¸ ì„œë¹„ìŠ¤ë¡œ ë³µì¡í•œ ë¡œì§ ë¶„ë¦¬
- ì˜ˆì™¸ë¥¼ í†µí•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìœ„ë°˜ ì²˜ë¦¬

### 5. í™•ì¥ì„±

- ìƒˆë¡œìš´ ì¸ì¦ ì œê³µì ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥
- ë¹„ë°€ë²ˆí˜¸ ì •ì±… í™•ì¥ ê°€ëŠ¥
- ì‚¬ìš©ì ìƒíƒœ í™•ì¥ ê°€ëŠ¥

### 6. ë³´ì•ˆì„± (Security) âœ¨

- **í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ì™„ì „ ì œê±°**: User ì—”í‹°í‹°ì—ì„œ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ì €ì¥ ê¸ˆì§€
- **í•´ì‹œë§Œ ì €ì¥**: ì˜¤ì§ bcrypt í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸ë§Œ ì €ì¥
- **ë„ë©”ì¸ ì„œë¹„ìŠ¤ í†µí•œ í•´ì‹±**: í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ëŠ” ë„ë©”ì¸ ì„œë¹„ìŠ¤ì—ì„œë§Œ ì²˜ë¦¬
- **ë©”ëª¨ë¦¬ ë³´ì•ˆ**: í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì—”í‹°í‹°ì— ì”ì¡´í•˜ì§€ ì•ŠìŒ
- **íƒ€ì… ì•ˆì „ì„±**: Password ê°’ ê°ì²´ëŠ” ìƒì„±/ê²€ì¦ ì‹œì—ë§Œ ì‚¬ìš©

## ğŸ”’ ë³´ì•ˆ ì•„í‚¤í…ì²˜ ê°œì„ ì‚¬í•­

### Before (ë³´ì•ˆ ì·¨ì•½)

```typescript
// âŒ User ì—”í‹°í‹°ì— í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ì™€ í•´ì‹œê°€ í•¨ê»˜ ì¡´ì¬
interface UserProps {
	password?: Password; // í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ (ìœ„í—˜!)
	passwordHash?: string; // í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸
}
```

### After (ë³´ì•ˆ ê°•í™”) âœ…

```typescript
// âœ… User ì—”í‹°í‹°ì—ëŠ” ì˜¤ì§ í•´ì‹œë§Œ ì €ì¥
interface CreateUserProps {
	passwordHash?: string; // í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸ë§Œ ì €ì¥
}

// âœ… í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ëŠ” ë„ë©”ì¸ ì„œë¹„ìŠ¤ì—ì„œë§Œ ì²˜ë¦¬
class UserDomainService {
	async createLocalUser(email: Email, password: Password) {
		// 1. í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¦‰ì‹œ í•´ì‹±
		const hashedPassword = await this.hashPassword(password);

		// 2. User ì—”í‹°í‹°ì—ëŠ” í•´ì‹œë§Œ ì „ë‹¬
		const user = User.create({
			email,
			passwordHash: hashedPassword, // í•´ì‹œë§Œ ì €ì¥
		});
	}
}
```

### ë³´ì•ˆ ì¥ì 

1. **ë©”ëª¨ë¦¬ ë³´ì•ˆ**: í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì—”í‹°í‹°ì— ì”ì¡´í•˜ì§€ ì•ŠìŒ
2. **ì§ë ¬í™” ë³´ì•ˆ**: `toJSON()` ë“±ì—ì„œ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ë…¸ì¶œ ë°©ì§€
3. **ë°ì´í„°ë² ì´ìŠ¤ ë³´ì•ˆ**: DBì—ëŠ” í•´ì‹œë§Œ ì €ì¥
4. **ì½”ë“œ ì•ˆì „ì„±**: ì»´íŒŒì¼ íƒ€ì„ì— í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ì‚¬ìš© ë°©ì§€

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ (Step 3: ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ)

êµ¬í˜„ ì˜ˆì •:

1. **ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤**

   - `src/auth/application/service/auth.service.ts`
   - `src/auth/application/service/user.service.ts`
   - `src/auth/application/service/jwt.service.ts`

2. **ì• í”Œë¦¬ì¼€ì´ì…˜ DTO**

   - `src/auth/application/dto/auth.dto.ts`
   - `src/auth/application/dto/user.dto.ts`

3. **ë„ë©”ì¸ ì´ë²¤íŠ¸**
   - `src/auth/application/event/user-registered.event.ts`
   - `src/auth/application/event/user-logged-in.event.ts`

## ğŸ”§ í•„ìš”í•œ ì¶”ê°€ íŒ¨í‚¤ì§€

```bash
# bcrypt for password hashing
pnpm add bcrypt
pnpm add -D @types/bcrypt
```

## ğŸ§ª ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¤€ë¹„

ë„ë©”ì¸ ê³„ì¸µì€ ì™¸ë¶€ ì˜ì¡´ì„±ì´ ì—†ì–´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ìš©ì´í•©ë‹ˆë‹¤:

- ê°’ ê°ì²´ í…ŒìŠ¤íŠ¸ (ìœ íš¨ì„± ê²€ì¦, ë¶ˆë³€ì„±)
- ì—”í‹°í‹° í…ŒìŠ¤íŠ¸ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
- ë„ë©”ì¸ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ (ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™)
- ì˜ˆì™¸ í…ŒìŠ¤íŠ¸ (ì—ëŸ¬ ì²˜ë¦¬)




# ğŸ¯ NestJS Clean Architecture Auth System - Step 3 ì™„ë£Œ í˜„í™©

## ğŸ“‹ Step 3: ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ êµ¬í˜„ ê°œìš”

- **ëª©í‘œ**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤, DTO, ë„ë©”ì¸ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ êµ¬í˜„
- **ì›ì¹™**: ë„ë©”ì¸ ê³„ì¸µì„ í™œìš©í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¡°ìœ¨, ì™¸ë¶€ì™€ì˜ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- **êµ¬ì¡°**: Application Service â†’ DTO â†’ Domain Event System

## âœ… Step 3: ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ ì™„ë£Œ ë‚´ì—­

### 1. ì• í”Œë¦¬ì¼€ì´ì…˜ DTO (Data Transfer Objects)

```typescript
// apps/auth-vC/src/auth/application/dto/

// auth.dto.ts                âœ… ì¸ì¦ ê´€ë ¨ DTO
-SignUpRequestDto - // íšŒì›ê°€ì… ìš”ì²­
	LoginRequestDto - // ë¡œê·¸ì¸ ìš”ì²­
	RefreshTokenRequestDto - // í† í° ê°±ì‹  ìš”ì²­
	AuthResponseDto - // ì¸ì¦ ì‘ë‹µ
	UserInfoDto - // ì‚¬ìš©ì ì •ë³´
	TokenResponseDto - // í† í° ì‘ë‹µ
	LogoutRequestDto - // ë¡œê·¸ì•„ì›ƒ ìš”ì²­
	// user.dto.ts                âœ… ì‚¬ìš©ì ê´€ë ¨ DTO
	CreateUserDto - // ì‚¬ìš©ì ìƒì„±
	UpdateUserDto - // ì‚¬ìš©ì ì—…ë°ì´íŠ¸
	ChangePasswordDto - // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
	GetUsersQueryDto - // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
	UserDetailDto - // ì‚¬ìš©ì ìƒì„¸ ì •ë³´
	UsersResponseDto - // ì‚¬ìš©ì ëª©ë¡ ì‘ë‹µ
	VerifyEmailDto - // ì´ë©”ì¼ ì¸ì¦
	// social-auth.dto.ts         âœ… ì†Œì…œ ì¸ì¦ DTO
	SocialLoginRequestDto - // ì†Œì…œ ë¡œê·¸ì¸ ìš”ì²­
	SocialLoginCallbackDto - // ì†Œì…œ ë¡œê·¸ì¸ ì½œë°±
	SocialProfileDto - // ì†Œì…œ í”„ë¡œí•„
	GoogleUserInfoDto - // Google ì‚¬ìš©ì ì •ë³´
	AppleUserInfoDto - // Apple ì‚¬ìš©ì ì •ë³´
	LinkAccountRequestDto - // ê³„ì • ì—°ê²° ìš”ì²­
	UnlinkAccountRequestDto - // ê³„ì • ì—°ê²° í•´ì œ
	SocialAccountDto; // ì†Œì…œ ê³„ì • ì •ë³´
```

**ì£¼ìš” íŠ¹ì§•:**

- class-validator ë°ì½”ë ˆì´í„°ë¡œ ìœ íš¨ì„± ê²€ì¦
- ëª…í™•í•œ ì…ì¶œë ¥ íƒ€ì… ì •ì˜
- í˜ì´ì§€ë„¤ì´ì…˜ ë° í•„í„°ë§ ì§€ì›
- ë³´ì•ˆì„ ìœ„í•œ ë¯¼ê° ì •ë³´ ì œì™¸

### 2. ë„ë©”ì¸ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ

#### ì´ë²¤íŠ¸ í´ë˜ìŠ¤ (Event Classes)

```typescript
// apps/auth-vC/src/auth/application/event/event/

// user-registered.event.ts    âœ… ì‚¬ìš©ì ë“±ë¡ ì´ë²¤íŠ¸
- ë°œìƒ ì‹œì : íšŒì›ê°€ì… ì™„ë£Œ ì‹œ
- í¬í•¨ ë°ì´í„°: userId, email, provider, isEmailVerified, registeredAt

// user-logged-in.event.ts     âœ… ì‚¬ìš©ì ë¡œê·¸ì¸ ì´ë²¤íŠ¸
- ë°œìƒ ì‹œì : ë¡œê·¸ì¸ ì„±ê³µ ì‹œ
- í¬í•¨ ë°ì´í„°: userId, email, ipAddress, userAgent, deviceInfo, loggedInAt

// user-deleted.event.ts       âœ… ì‚¬ìš©ì ì‚­ì œ ì´ë²¤íŠ¸
- ë°œìƒ ì‹œì : ê³„ì • ì‚­ì œ ì‹œ
- í¬í•¨ ë°ì´í„°: userId, email, provider, deletedBy, reason, deletedAt
```

#### ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (Event Handlers)

```typescript
// apps/auth-vC/src/auth/application/event/handler/

// user-registered.handler.ts  âœ… ë“±ë¡ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
- ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ ë°œì†¡
- í™˜ì˜ ì´ë©”ì¼ ë°œì†¡
- ì‚¬ìš©ì ë“±ë¡ í†µê³„ ì—…ë°ì´íŠ¸
- ê´€ë¦¬ìì—ê²Œ ì‹ ê·œ ê°€ì… ì•Œë¦¼

// user-logged-in.handler.ts   âœ… ë¡œê·¸ì¸ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
- ë¡œê·¸ì¸ ë¡œê·¸ ê¸°ë¡
- ë³´ì•ˆ ê²€ì‚¬ (ë¹„ì •ìƒì  ì ‘ê·¼ ê°ì§€)
- ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í™œë™ ê°ì§€
- ë¡œê·¸ì¸ ì•Œë¦¼ ë°œì†¡

// user-deleted.handler.ts     âœ… ì‚­ì œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
- ì‚¬ìš©ì ê´€ë ¨ ë°ì´í„° ì •ë¦¬
- ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™ í•´ì œ
- ì‚­ì œ ë¡œê·¸ ê¸°ë¡ ë° ê´€ë¦¬ì ì•Œë¦¼
- ë°ì´í„° ì•„ì¹´ì´ë¸Œ ì²˜ë¦¬
```

### 3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ (Application Services)

#### AuthApplicationService (ì¸ì¦ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤)

```typescript
// apps/auth-vC/src/auth/application/service/auth.service.ts âœ…

ì£¼ìš” ê¸°ëŠ¥:
- signUp()           // íšŒì›ê°€ì… ì²˜ë¦¬ (ë„ë©”ì¸ ì„œë¹„ìŠ¤ í™œìš©, ì´ë²¤íŠ¸ ë°œí–‰)
- login()            // ë¡œê·¸ì¸ ì²˜ë¦¬ (ì¸ì¦, í† í° ìƒì„±, ì´ë²¤íŠ¸ ë°œí–‰)
- refreshToken()     // í† í° ê°±ì‹  (JWT ê²€ì¦, DB í† í° í™•ì¸)
- logout()           // ë¡œê·¸ì•„ì›ƒ (íŠ¹ì • í† í° ë¬´íš¨í™”)
- logoutAll()        // ì „ì²´ ë¡œê·¸ì•„ì›ƒ (ëª¨ë“  í† í° ì‚­ì œ)
- getCurrentUser()   // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ

êµ¬í˜„ íŠ¹ì§•:
- ë„ë©”ì¸ ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
- ì´ë²¤íŠ¸ ë°œí–‰ìœ¼ë¡œ ëŠìŠ¨í•œ ê²°í•©
- JWT ì„œë¹„ìŠ¤ì™€ í˜‘ë ¥í•˜ì—¬ í† í° ê´€ë¦¬
- ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…
```

#### UserApplicationService (ì‚¬ìš©ì ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤)

```typescript
// apps/auth-vC/src/auth/application/service/user.service.ts âœ…

ì£¼ìš” ê¸°ëŠ¥:
- getUsers()         // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜, í•„í„°ë§)
- getUserById()      // íŠ¹ì • ì‚¬ìš©ì ì¡°íšŒ
- updateUser()       // ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸
- changePassword()   // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦)
- deleteUser()       // ì‚¬ìš©ì ê³„ì • ì‚­ì œ (ì†Œí”„íŠ¸ ì‚­ì œ, ì´ë²¤íŠ¸ ë°œí–‰)
- verifyEmail()      // ì´ë©”ì¼ ì¸ì¦ ì²˜ë¦¬
- getUserStats()     // ì‚¬ìš©ì í†µê³„ ì¡°íšŒ

êµ¬í˜„ íŠ¹ì§•:
- í˜ì´ì§€ë„¤ì´ì…˜ ë° ì •ë ¬ ì§€ì›
- ë„ë©”ì¸ ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
- ì´ë²¤íŠ¸ ê¸°ë°˜ ì‚­ì œ ì²˜ë¦¬
- í†µê³„ ë°ì´í„° ì œê³µ
```

#### PasswordApplicationService (ë¹„ë°€ë²ˆí˜¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤)

```typescript
// apps/auth-vC/src/auth/application/service/password.service.ts âœ…

ì£¼ìš” ê¸°ëŠ¥:
- forgotPassword()   // ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° (ë³´ì•ˆìƒ í•­ìƒ ì„±ê³µ ì‘ë‹µ)
- resetPassword()    // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • (í† í° ê²€ì¦, ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •)
- validatePasswordStrength()  // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ê²€ì¦
- generateTemporaryPassword() // ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ìƒì„±
- getPasswordPolicy()         // ë¹„ë°€ë²ˆí˜¸ ì •ì±… ì¡°íšŒ
- checkPasswordExpiry()       // ë¹„ë°€ë²ˆí˜¸ ë§Œë£Œ í™•ì¸

êµ¬í˜„ íŠ¹ì§•:
- ë³´ì•ˆ ì¤‘ì‹¬ ì„¤ê³„ (í† í° ê¸°ë°˜ ì¬ì„¤ì •)
- ë¹„ë°€ë²ˆí˜¸ ì •ì±… ì¤€ìˆ˜
- ë„ë©”ì¸ ì„œë¹„ìŠ¤ í™œìš©
- ì´ë©”ì¼ ë°œì†¡ ë¡œì§ í¬í•¨
```

#### SocialAuthApplicationService (ì†Œì…œ ì¸ì¦ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤)

```typescript
// apps/auth-vC/src/auth/application/service/social-auth.service.ts âœ…

ì£¼ìš” ê¸°ëŠ¥:
- socialLogin()      // ì†Œì…œ ë¡œê·¸ì¸ ì²˜ë¦¬ (ê¸°ì¡´/ì‹ ê·œ ì‚¬ìš©ì êµ¬ë¶„)
- linkAccount()      // ì†Œì…œ ê³„ì • ì—°ê²°
- unlinkAccount()    // ì†Œì…œ ê³„ì • ì—°ê²° í•´ì œ
- getLinkedAccounts() // ì—°ê²°ëœ ì†Œì…œ ê³„ì • ëª©ë¡
- generateAuthUrl()  // ì†Œì…œ ë¡œê·¸ì¸ URL ìƒì„±

êµ¬í˜„ íŠ¹ì§•:
- Google, Apple ì§€ì›
- ê³„ì • ì—°ê²°/í•´ì œ ë¡œì§
- í”„ë¡œí•„ ì •ë³´ ë§¤í•‘
- ë„ë©”ì¸ ì„œë¹„ìŠ¤ì™€ í˜‘ë ¥
```

#### JwtApplicationService (JWT ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤)

```typescript
// apps/auth-vC/src/auth/application/service/jwt.service.ts âœ…

ì£¼ìš” ê¸°ëŠ¥:
- generateAccessToken()    // Access Token ìƒì„±
- generateRefreshToken()   // Refresh Token ìƒì„±
- generateTokenPair()      // í† í° ìŒ ìƒì„±
- verifyAccessToken()      // Access Token ê²€ì¦
- verifyRefreshToken()     // Refresh Token ê²€ì¦
- extractUserIdFromToken() // í† í°ì—ì„œ ì‚¬ìš©ì ID ì¶”ì¶œ
- isTokenExpired()         // í† í° ë§Œë£Œ í™•ì¸
- getAccessTokenExpiresIn() // Access Token TTL
- getRefreshTokenExpiresIn() // Refresh Token TTL

êµ¬í˜„ íŠ¹ì§•:
- Access/Refresh í† í° ë¶„ë¦¬ ê´€ë¦¬
- ë³´ì•ˆ ê°•í™” (issuer, audience ê²€ì¦)
- TTL ê´€ë¦¬ ë° ë§Œë£Œ ê²€ì‚¬
- ì—ëŸ¬ ì²˜ë¦¬ ë° ìœ íš¨ì„± ê²€ì¦
```

### 4. ğŸ”§ ê¸°ìˆ ì  í•´ê²°ì‚¬í•­

#### JWT ì„œë¹„ìŠ¤ ë°ì½”ë ˆì´í„° ë¬¸ì œ í•´ê²°

```typescript
// âŒ ë¬¸ì œ ë°œìƒ ì½”ë“œ:
constructor(
  private readonly jwtService: NestJwtService,
  @Inject(jwtConfig.KEY)
  private readonly jwtConfiguration: ConfigType<typeof jwtConfig>  // ë°ì½”ë ˆì´í„° + ë§¤ê°œë³€ìˆ˜ í”„ë¡œí¼í‹°
) {}

// âœ… í•´ê²°ëœ ì½”ë“œ (ë°©ë²• 1):
private readonly jwtConfiguration: ConfigType<typeof jwtConfig>;

constructor(
  private readonly jwtService: NestJwtService,
  @Inject(jwtConfig.KEY)
  jwtConfiguration: ConfigType<typeof jwtConfig>  // ë°ì½”ë ˆì´í„°ì™€ ë§¤ê°œë³€ìˆ˜ ë¶„ë¦¬
) {
  this.jwtConfiguration = jwtConfiguration;
}
```

**ë¬¸ì œ ì›ì¸:**

- TypeScript ì»´íŒŒì¼ëŸ¬ì˜ ë°ì½”ë ˆì´í„° + ë§¤ê°œë³€ìˆ˜ í”„ë¡œí¼í‹° ì¡°í•© í•´ì„ ì´ìŠˆ
- NestJSì˜ `@Inject` ë°ì½”ë ˆì´í„°ì™€ ìƒì„±ì ë§¤ê°œë³€ìˆ˜ í”„ë¡œí¼í‹° ê°„ì˜ ì¶©ëŒ

**í•´ê²° ë°©ë²•:**

- ë°ì½”ë ˆì´í„°ì™€ ë§¤ê°œë³€ìˆ˜ í”„ë¡œí¼í‹° ë¶„ë¦¬
- ìˆ˜ë™ í• ë‹¹ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„±ê³¼ NestJS íŒ¨í„´ ìœ ì§€

### 5. ğŸ“ ì™„ì„±ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ êµ¬ì¡°

```
apps/auth-vC/src/auth/application/
â”œâ”€â”€ service/                           # ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ auth.service.ts               âœ… ì¸ì¦ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ user.service.ts              âœ… ì‚¬ìš©ì ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ password.service.ts          âœ… ë¹„ë°€ë²ˆí˜¸ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ social-auth.service.ts       âœ… ì†Œì…œ ì¸ì¦ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ jwt.service.ts               âœ… JWT ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ index.ts                     âœ… ì„œë¹„ìŠ¤ export
â”œâ”€â”€ dto/                              # ì• í”Œë¦¬ì¼€ì´ì…˜ DTO
â”‚   â”œâ”€â”€ auth.dto.ts                  âœ… ì¸ì¦ DTO
â”‚   â”œâ”€â”€ user.dto.ts                  âœ… ì‚¬ìš©ì DTO
â”‚   â”œâ”€â”€ social-auth.dto.ts           âœ… ì†Œì…œ ì¸ì¦ DTO
â”‚   â””â”€â”€ index.ts                     âœ… DTO export
â””â”€â”€ event/                            # ë„ë©”ì¸ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ
    â”œâ”€â”€ event/                        # ì´ë²¤íŠ¸ í´ë˜ìŠ¤
    â”‚   â”œâ”€â”€ user-registered.event.ts  âœ… ë“±ë¡ ì´ë²¤íŠ¸
    â”‚   â”œâ”€â”€ user-logged-in.event.ts   âœ… ë¡œê·¸ì¸ ì´ë²¤íŠ¸
    â”‚   â”œâ”€â”€ user-deleted.event.ts     âœ… ì‚­ì œ ì´ë²¤íŠ¸
    â”‚   â””â”€â”€ index.ts                  âœ… ì´ë²¤íŠ¸ export
    â””â”€â”€ handler/                      # ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        â”œâ”€â”€ user-registered.handler.ts âœ… ë“±ë¡ í•¸ë“¤ëŸ¬
        â”œâ”€â”€ user-logged-in.handler.ts  âœ… ë¡œê·¸ì¸ í•¸ë“¤ëŸ¬
        â”œâ”€â”€ user-deleted.handler.ts    âœ… ì‚­ì œ í•¸ë“¤ëŸ¬
        â””â”€â”€ index.ts                   âœ… í•¸ë“¤ëŸ¬ export
```

## ğŸ¯ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ í•µì‹¬ íŠ¹ì§•

### 1. ì±…ì„ ë¶„ë¦¬ (Separation of Concerns)

- **ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤**: ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° ì¡°ìœ¨, ë„ë©”ì¸ ì„œë¹„ìŠ¤ í˜¸ì¶œ
- **DTO**: ë°ì´í„° ì „ì†¡ ë° ìœ íš¨ì„± ê²€ì¦
- **ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ**: íš¡ë‹¨ ê´€ì‹¬ì‚¬ ì²˜ë¦¬ (ë¡œê¹…, ì•Œë¦¼, í†µê³„)

### 2. ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„

- ë„ë©”ì¸ ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•œ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
- ë„ë©”ì¸ ì˜ˆì™¸ë¥¼ í†µí•œ ì¼ê´€ëœ ì—ëŸ¬ ì²˜ë¦¬
- ë„ë©”ì¸ ì—”í‹°í‹°ì™€ ê°’ ê°ì²´ í™œìš©

### 3. ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜

- ëŠìŠ¨í•œ ê²°í•©ìœ¼ë¡œ í™•ì¥ì„± í–¥ìƒ
- íš¡ë‹¨ ê´€ì‹¬ì‚¬ì˜ ë…ë¦½ì  ì²˜ë¦¬
- ë¹„ë™ê¸° ì²˜ë¦¬ ì§€ì› ì¤€ë¹„

### 4. ë³´ì•ˆ ì¤‘ì‹¬ ì„¤ê³„

- JWT í† í° ë¶„ë¦¬ ê´€ë¦¬ (Access/Refresh)
- ë¹„ë°€ë²ˆí˜¸ ì •ì±… ë° ê°•ë„ ê²€ì¦
- ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì  ë° ë¡œê¹…

### 5. í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°

- ìƒˆë¡œìš´ ì†Œì…œ ë¡œê·¸ì¸ ì œê³µì ì‰½ê²Œ ì¶”ê°€
- ì¶”ê°€ì ì¸ ì´ë²¤íŠ¸ ë° í•¸ë“¤ëŸ¬ í™•ì¥ ê°€ëŠ¥
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¶„ë¦¬ ì¤€ë¹„

## ğŸ”„ ì´ë²¤íŠ¸ í”Œë¡œìš° ì˜ˆì‹œ

### íšŒì›ê°€ì… í”Œë¡œìš°:

```
1. AuthApplicationService.signUp()
2. â†’ UserDomainService.createLocalUser()
3. â†’ User.create() (ë„ë©”ì¸ ì—”í‹°í‹°)
4. â†’ UserRepository.save() (TODO: Step 4)
5. â†’ EventEmitter.emit(UserRegisteredEvent)
6. â†’ UserRegisteredHandler.handle()
   - ì´ë©”ì¼ ì¸ì¦ ë°œì†¡
   - í™˜ì˜ ë©”ì‹œì§€ ë°œì†¡
   - í†µê³„ ì—…ë°ì´íŠ¸
```

### ë¡œê·¸ì¸ í”Œë¡œìš°:

```
1. AuthApplicationService.login()
2. â†’ UserDomainService.authenticateUser()
3. â†’ PasswordDomainService.verify()
4. â†’ JwtApplicationService.generateTokenPair()
5. â†’ RefreshTokenRepository.save() (TODO: Step 4)
6. â†’ EventEmitter.emit(UserLoggedInEvent)
7. â†’ UserLoggedInHandler.handle()
   - ë¡œê·¸ì¸ ë¡œê·¸ ê¸°ë¡
   - ë³´ì•ˆ ê²€ì‚¬
   - ì•Œë¦¼ ë°œì†¡
```

## ğŸš€ ì™„ë£Œëœ ê¸°ëŠ¥ë“¤

### ğŸ” ì¸ì¦ ê¸°ëŠ¥

- âœ… ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ íšŒì›ê°€ì…
- âœ… ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸
- âœ… JWT í† í° ê¸°ë°˜ ì¸ì¦
- âœ… í† í° ê°±ì‹  (Refresh Token)
- âœ… ë¡œê·¸ì•„ì›ƒ (ë‹¨ì¼/ì „ì²´ ë””ë°”ì´ìŠ¤)

### ğŸ‘¤ ì‚¬ìš©ì ê´€ë¦¬

- âœ… ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ/ìˆ˜ì •
- âœ… ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
- âœ… ê³„ì • ì‚­ì œ (ì†Œí”„íŠ¸ ì‚­ì œ)
- âœ… ì´ë©”ì¼ ì¸ì¦
- âœ… ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)

### ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬

- âœ… ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
- âœ… ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •
- âœ… ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ê²€ì¦
- âœ… ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ìƒì„±
- âœ… ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê´€ë¦¬

### ğŸŒ ì†Œì…œ ë¡œê·¸ì¸

- âœ… Google ë¡œê·¸ì¸ ì§€ì›
- âœ… Apple ë¡œê·¸ì¸ ì§€ì›
- âœ… ì†Œì…œ ê³„ì • ì—°ê²°/í•´ì œ
- âœ… ì—°ê²°ëœ ê³„ì • ê´€ë¦¬

### ğŸ“Š ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ

- âœ… ì‚¬ìš©ì ë“±ë¡ ì´ë²¤íŠ¸ ì²˜ë¦¬
- âœ… ë¡œê·¸ì¸ ì¶”ì  ë° ë³´ì•ˆ ê²€ì‚¬
- âœ… ê³„ì • ì‚­ì œ í›„ ì •ë¦¬ ì‘ì—…
- âœ… í™•ì¥ ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ êµ¬ì¡°

## ğŸ“¦ ì‚¬ìš©ëœ ì£¼ìš” íŒ¨í‚¤ì§€

```json
{
	"dependencies": {
		"@nestjs/common": "^10.0.0",
		"@nestjs/config": "^3.0.0",
		"@nestjs/event-emitter": "^2.0.0",
		"@nestjs/jwt": "^10.0.0",
		"class-validator": "^0.14.0",
		"class-transformer": "^0.5.0",
		"bcrypt": "^5.1.0"
	},
	"devDependencies": {
		"@types/bcrypt": "^5.0.0"
	}
}
```

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„: Step 4 - ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ

êµ¬í˜„ ì˜ˆì •:

### 1. ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´

- `user.typeorm.repository.ts` - ì‚¬ìš©ì ë°ì´í„° ì˜ì†ì„±
- `refresh-token.typeorm.repository.ts` - í† í° ë°ì´í„° ì˜ì†ì„±

### 2. ì™¸ë¶€ ì„œë¹„ìŠ¤

- `google-auth.service.ts` - Google OAuth ì—°ë™
- `apple-auth.service.ts` - Apple OAuth ì—°ë™
- `email.service.ts` - ì´ë©”ì¼ ë°œì†¡ ì„œë¹„ìŠ¤

### 3. ë³´ì•ˆ ê³„ì¸µ

- `jwt-auth.guard.ts` - JWT ì¸ì¦ ê°€ë“œ
- `refresh-token.guard.ts` - ë¦¬í”„ë ˆì‹œ í† í° ê°€ë“œ
- `optional-auth.guard.ts` - ì„ íƒì  ì¸ì¦ ê°€ë“œ

### 4. Passport ì „ëµ

- `jwt.strategy.ts` - JWT ì „ëµ
- `refresh-token.strategy.ts` - ë¦¬í”„ë ˆì‹œ í† í° ì „ëµ
- `google.strategy.ts` - Google OAuth ì „ëµ
- `apple.strategy.ts` - Apple OAuth ì „ëµ

### 5. ì„¤ì • ë° ëª¨ë“ˆ

- `social-auth.config.ts` - ì†Œì…œ ë¡œê·¸ì¸ ì„¤ì •
- `auth-infrastructure.module.ts` - ì¸í”„ë¼ ëª¨ë“ˆ ì„¤ì •

## ğŸ” Step 3ì—ì„œ ì–»ì€ êµí›ˆ

1. **NestJS ë°ì½”ë ˆì´í„° íŒ¨í„´**: `@Inject`ì™€ ë§¤ê°œë³€ìˆ˜ í”„ë¡œí¼í‹° ì¡°í•© ì‹œ ì£¼ì˜ í•„ìš”
2. **ì´ë²¤íŠ¸ ê¸°ë°˜ ì„¤ê³„**: íš¡ë‹¨ ê´€ì‹¬ì‚¬ë¥¼ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬ ê°€ëŠ¥
3. **íƒ€ì… ì•ˆì „ì„±**: DTOì™€ ë„ë©”ì¸ ê°ì²´ ê°„ì˜ ëª…í™•í•œ ë³€í™˜ ì¤‘ìš”
4. **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ê°€ ë„ë©”ì¸ ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°
5. **í™•ì¥ì„±**: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”

## ğŸ’¡ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ì •ë¦¬

1. **ì„œë¹„ìŠ¤ ë¶„ë¦¬**: ê° ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ëŠ” ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜
2. **DTO í™œìš©**: ì…ì¶œë ¥ ë°ì´í„° ê²€ì¦ ë° íƒ€ì… ì•ˆì „ì„± í™•ë³´
3. **ì´ë²¤íŠ¸ í™œìš©**: ë¶€ìˆ˜ íš¨ê³¼ë¥¼ ì´ë²¤íŠ¸ë¡œ ë¶„ë¦¬í•˜ì—¬ ê²°í•©ë„ ë‚®ì¶¤
4. **ì—ëŸ¬ ì²˜ë¦¬**: ë„ë©”ì¸ ì˜ˆì™¸ë¥¼ í™œìš©í•œ ì¼ê´€ëœ ì—ëŸ¬ ì²˜ë¦¬
5. **ë³´ì•ˆ ê³ ë ¤**: ëª¨ë“  ì¸ì¦/ì¸ê°€ ë¡œì§ì—ì„œ ë³´ì•ˆ ê²€ì¦ ì² ì €íˆ ìˆ˜í–‰

---

**Step 3 ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ êµ¬í˜„ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰**




# ğŸ¯ NestJS Clean Architecture Auth System - Step 4 ì™„ë£Œ í˜„í™©

## ğŸ“‹ Step 4: ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ êµ¬í˜„ ê°œìš”

- **ëª©í‘œ**: ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´, ì™¸ë¶€ ì„œë¹„ìŠ¤, ë³´ì•ˆ ê³„ì¸µ, ì„¤ì • ê´€ë¦¬ êµ¬í˜„
- **ì›ì¹™**: ë„ë©”ì¸ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‹¤ì œ ê¸°ìˆ  ìŠ¤íƒìœ¼ë¡œ êµ¬í˜„
- **êµ¬ì¡°**: Repository Implementation â†’ External Services â†’ Security Guards â†’ Configuration

## âœ… Step 4: ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ ì™„ë£Œ ë‚´ì—­

### 1. ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´ (Database Layer)

```typescript
// apps/auth-vC/src/auth/infrastructure/database/repository/

// user.typeorm.repository.ts         âœ… ì‚¬ìš©ì ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´
- TypeORM ê¸°ë°˜ ì‚¬ìš©ì ë°ì´í„° ì˜ì†ì„± ê´€ë¦¬
- CRUD ê¸°ë³¸ operations (save, findById, findByEmail, delete)
- ì†Œì…œ ë¡œê·¸ì¸ ì§€ì› (findByProviderAndProviderId)
- í˜ì´ì§€ë„¤ì´ì…˜ ë° í•„í„°ë§ (findMany with options)
- ìƒíƒœ ê´€ë¦¬ (updateStatus, updateLastLoginAt, updateEmailVerificationStatus)
- í†µê³„ ê¸°ëŠ¥ (countByProvider, countActiveUsers)
- ë„ë©”ì¸ ì—”í‹°í‹° â†” TypeORM ì—”í‹°í‹° ë³€í™˜

// refresh-token.typeorm.repository.ts âœ… ë¦¬í”„ë ˆì‹œ í† í° ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´
- RefreshToken ë°ì´í„° ì˜ì†ì„± ê´€ë¦¬
- í† í° CRUD operations (save, findById, findByToken, delete)
- ì‚¬ìš©ìë³„ í† í° ê´€ë¦¬ (findActiveTokensByUserId, deleteAllByUserId)
- ë””ë°”ì´ìŠ¤ë³„ í† í° ê´€ë¦¬ (findByUserIdAndDeviceInfo, deleteByUserIdAndDeviceInfo)
- í† í° ìƒëª…ì£¼ê¸° ê´€ë¦¬ (deleteExpiredTokens, deactivateToken)
- ë³´ì•ˆ ê¸°ëŠ¥ (countActiveTokensByUserId, deleteOldTokensByUserId)
- í† í° ì‚¬ìš© ì¶”ì  (updateLastUsedAt)
```

#### ğŸ”§ RefreshTokenRepository ì£¼ìš” ìˆ˜ì •ì‚¬í•­

```typescript
// ë©”ì„œë“œëª… ìˆ˜ì • ë° ë¡œì§ ê°œì„ 
- findActiveByUserId() â†’ findActiveTokensByUserId()  // ì¸í„°í˜ì´ìŠ¤ ì¼ì¹˜
- LessThan(new Date()) â†’ MoreThan(new Date())        // ë§Œë£Œ í† í° â†’ í™œì„± í† í° ì¡°íšŒ
- deleteByUserId() â†’ deleteAllByUserId()             // ëª…í™•í•œ ë©”ì„œë“œëª…

// ëˆ„ë½ëœ ë©”ì„œë“œë“¤ ì¶”ê°€ êµ¬í˜„
+ existsByToken(token: string): Promise<boolean>
+ deleteByUserIdAndDeviceInfo(userId: UserId, deviceInfo: string): Promise<void>
+ updateLastUsedAt(id: string, lastUsedAt: Date): Promise<void>
+ deactivateToken(id: string): Promise<void>
+ deleteOldTokensByUserId(userId: UserId, keepCount: number): Promise<number>

// ë„ë©”ì¸ ì—”í‹°í‹° ë©”ì„œë“œ í˜¸ì¶œ ìˆ˜ì •
- refreshToken.isActive() â†’ refreshToken.getIsActive()  // ì˜¬ë°”ë¥¸ getter ì‚¬ìš©
```

### 2. ì™¸ë¶€ ì„œë¹„ìŠ¤ (External Services)

```typescript
// apps/auth-vC/src/auth/infrastructure/external-service/

// email.service.ts                   âœ… ì´ë©”ì¼ ë°œì†¡ ì„œë¹„ìŠ¤
- í™˜ì˜ ì´ë©”ì¼, ì´ë©”ì¼ ì¸ì¦, ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë“± ë‹¤ì–‘í•œ í…œí”Œë¦¿ ì§€ì›
- ê°œë°œ í™˜ê²½: ì½˜ì†” ë¡œê·¸ ì¶œë ¥ìœ¼ë¡œ ì´ë©”ì¼ ë‚´ìš© í™•ì¸
- í”„ë¡œë•ì…˜ í™˜ê²½: ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ ë¡œì§ (í™•ì¥ ì¤€ë¹„)
- HTML í…œí”Œë¦¿ ê¸°ë°˜ ì´ë©”ì¼ ìƒì„±
- ë³´ì•ˆ ì•Œë¦¼ ë° ë¡œê·¸ì¸ ì•Œë¦¼ ê¸°ëŠ¥

// google-auth.service.ts             âœ… Google OAuth ì„œë¹„ìŠ¤
- Google OAuth 2.0 í”Œë¡œìš° ì§€ì›
- ì¸ì¦ URL ìƒì„± (generateAuthUrl)
- ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (getUserInfo)
- ê°œë°œ ëª¨ë“œì—ì„œ ëª©ì—… ë°ì´í„° ì œê³µ
- ConfigService ê¸°ë°˜ ì„¤ì • ê´€ë¦¬

// apple-auth.service.ts              âœ… Apple OAuth ì„œë¹„ìŠ¤
- Apple Sign In ì§€ì›
- Apple ID í† í° ê²€ì¦ (verifyIdentityToken)
- ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ (getUserInfo)
- Apple ì¸ì¦ URL ìƒì„±
- ê°œë°œ ëª¨ë“œ ëª©ì—… ë°ì´í„° ì§€ì›
```

### 3. ë³´ì•ˆ ê³„ì¸µ (Security Guards)

```typescript
// apps/auth-vC/src/auth/infrastructure/guard/

// jwt-auth.guard.ts                  âœ… JWT ì¸ì¦ ê°€ë“œ
- Bearer í† í° ì¶”ì¶œ ë° ê²€ì¦
- @Public() ë°ì½”ë ˆì´í„° ì§€ì› (ì¸ì¦ ìš°íšŒ)
- í† í° ë§Œë£Œ/ë¬´íš¨ ì—ëŸ¬ ì²˜ë¦¬
- ì‚¬ìš©ì ì •ë³´ë¥¼ request ê°ì²´ì— ì£¼ì…
- ìƒì„¸í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ

// refresh-token.guard.ts             âœ… ë¦¬í”„ë ˆì‹œ í† í° ê°€ë“œ
- ìš”ì²­ bodyì—ì„œ refreshToken ì¶”ì¶œ
- í† í° ì¡´ì¬ ì—¬ë¶€ ê²€ì¦
- request ê°ì²´ì— í† í° ì •ë³´ ì €ì¥
- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í† í° ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì§€ì›

// optional-auth.guard.ts             âœ… ì„ íƒì  ì¸ì¦ ê°€ë“œ
- í† í°ì´ ìˆìœ¼ë©´ ê²€ì¦, ì—†ì–´ë„ í†µê³¼
- ê³µê°œ APIì™€ ì¸ì¦ API í˜¼ìš© ì‹œ ì‚¬ìš©
- í† í° ìœ íš¨ì„±ì— ê´€ê³„ì—†ì´ ìš”ì²­ ì²˜ë¦¬
- ì‚¬ìš©ì ì •ë³´ê°€ ìˆì„ ë•Œë§Œ context ì œê³µ
```

### 4. ì„¤ì • ê´€ë¦¬ (Configuration)

```typescript
// apps/auth-vC/src/auth/infrastructure/config/

// social-auth.config.ts              âœ… ì†Œì…œ ë¡œê·¸ì¸ ì„¤ì •
- Google OAuth ì„¤ì • (Client ID, Secret, Callback URL)
- Apple Sign In ì„¤ì • (Client ID, Team ID, Key ID, Private Key)
- í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì • ê´€ë¦¬
- ê¸°ë³¸ê°’ ì œê³µìœ¼ë¡œ ê°œë°œ í™˜ê²½ ì§€ì›
```

### 5. ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ëª¨ë“ˆ í†µí•©

```typescript
// auth-infrastructure.module.ts      âœ… ì¸í”„ë¼ ëª¨ë“ˆ ì—…ë°ì´íŠ¸
imports: [
  TypeOrmModule.forFeature([UserTypeOrmEntity, RefreshTokenTypeOrmEntity]),
  ConfigModule.forFeature(socialAuthConfig),
],
providers: [
  // ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´ë“¤
  UserTypeormRepository,
  RefreshTokenTypeormRepository,
  // ì™¸ë¶€ ì„œë¹„ìŠ¤ë“¤
  EmailService,
  GoogleAuthService,
  AppleAuthService,
  // ê°€ë“œë“¤
  JwtAuthGuard,
  RefreshTokenGuard,
  OptionalAuthGuard,
],
exports: [
  // ëª¨ë“  êµ¬ì„±ìš”ì†Œë¥¼ ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ export
]
```

### 6. ì¸ë±ìŠ¤ íŒŒì¼ ì •ë¦¬

```typescript
// ê¹”ë”í•œ import/export ê´€ë¦¬
database/repository/index.ts          âœ…
external-service/index.ts             âœ…
guard/index.ts                        âœ…
```

## ğŸ“ ì™„ì„±ëœ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ êµ¬ì¡°

```
apps/auth-vC/src/auth/infrastructure/
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ entity/                    # TypeORM ì—”í‹°í‹° (Step 1 ì™„ë£Œ)
â”‚   â”‚   â”œâ”€â”€ user.typeorm.entity.ts
â”‚   â”‚   â””â”€â”€ refresh-token.typeorm.entity.ts
â”‚   â”œâ”€â”€ repository/               # ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´
â”‚   â”‚   â”œâ”€â”€ user.typeorm.repository.ts        âœ…
â”‚   â”‚   â”œâ”€â”€ refresh-token.typeorm.repository.ts âœ… (ìˆ˜ì • ì™„ë£Œ)
â”‚   â”‚   â””â”€â”€ index.ts              âœ…
â”‚   â””â”€â”€ migration/                # DB ë§ˆì´ê·¸ë ˆì´ì…˜ (Step 1 ì™„ë£Œ)
â”œâ”€â”€ external-service/             # ì™¸ë¶€ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ email.service.ts          âœ…
â”‚   â”œâ”€â”€ google-auth.service.ts    âœ…
â”‚   â”œâ”€â”€ apple-auth.service.ts     âœ…
â”‚   â””â”€â”€ index.ts                  âœ…
â”œâ”€â”€ guard/                        # ë³´ì•ˆ ê°€ë“œ
â”‚   â”œâ”€â”€ jwt-auth.guard.ts         âœ…
â”‚   â”œâ”€â”€ refresh-token.guard.ts    âœ…
â”‚   â”œâ”€â”€ optional-auth.guard.ts    âœ…
â”‚   â””â”€â”€ index.ts                  âœ…
â”œâ”€â”€ config/                       # ì„¤ì •
â”‚   â””â”€â”€ social-auth.config.ts     âœ…
â””â”€â”€ auth-infrastructure.module.ts âœ… (ì—…ë°ì´íŠ¸ ì™„ë£Œ)
```

## ğŸ¯ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ í•µì‹¬ íŠ¹ì§•

### 1. ì™„ì „í•œ ì¶”ìƒí™” (Complete Abstraction)

- ë„ë©”ì¸ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µì´ ì™¸ë¶€ ê¸°ìˆ ì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ì˜ì¡´ì„± ì£¼ì…ìœ¼ë¡œ ëŠìŠ¨í•œ ê²°í•©
- í…ŒìŠ¤íŠ¸ ì‹œ ëª©ì—… êµ¬í˜„ì²´ë¡œ ì‰½ê²Œ êµì²´ ê°€ëŠ¥

### 2. í™•ì¥ ê°€ëŠ¥ì„± (Extensibility)

- ìƒˆë¡œìš´ ì†Œì…œ ë¡œê·¸ì¸ ì œê³µì ì‰½ê²Œ ì¶”ê°€
- ë‹¤ì–‘í•œ ì´ë©”ì¼ ì„œë¹„ìŠ¤ ì œê³µì ì§€ì› ì¤€ë¹„
- ì¶”ê°€ì ì¸ ë³´ì•ˆ ì •ì±… ë° ê°€ë“œ í™•ì¥ ê°€ëŠ¥

### 3. ê°œë°œ ì¹œí™”ì„± (Developer Experience)

- ê°œë°œ í™˜ê²½ì—ì„œ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—†ì´ë„ ë™ì‘
- ì½˜ì†” ë¡œê·¸ë¥¼ í†µí•œ ì´ë©”ì¼ ë‚´ìš© í™•ì¸
- ëª©ì—… ë°ì´í„°ë¡œ ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘ ì§€ì›

### 4. ë³´ì•ˆ ì¤‘ì‹¬ ì„¤ê³„ (Security-First)

- JWT í† í° ê²€ì¦ ë° ì‚¬ìš©ì ì¸ì¦
- ë‹¤ì–‘í•œ ì¸ì¦ ì •ì±… ì§€ì› (í•„ìˆ˜/ì„ íƒì )
- í† í° ìƒëª…ì£¼ê¸° ì™„ì „ ê´€ë¦¬
- ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì  ë° ë¡œê¹…

### 5. í”„ë¡œë•ì…˜ ì¤€ë¹„ (Production Ready)

- ì‹¤ì œ ì„œë¹„ìŠ¤ ë°°í¬ì— í•„ìš”í•œ ëª¨ë“  êµ¬ì„±ìš”ì†Œ ì™„ì„±
- í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬ ë° ê´€ë¦¬
- ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹… ì²´ê³„ êµ¬ì¶•
- ì„±ëŠ¥ ìµœì í™” (í˜ì´ì§€ë„¤ì´ì…˜, ì¸ë±ìŠ¤ í™œìš©)

## ğŸ”§ ì£¼ìš” ê¸°ìˆ ì  í•´ê²°ì‚¬í•­

### 1. TypeORM ë§¤í•‘ ìµœì í™”

- ë„ë©”ì¸ ì—”í‹°í‹° â†” TypeORM ì—”í‹°í‹° ë³€í™˜ ë¡œì§
- ë³µì¡í•œ ì¿¼ë¦¬ ì¡°ê±´ ë° í˜ì´ì§€ë„¤ì´ì…˜ ì²˜ë¦¬
- ê´€ê³„í˜• ë°ì´í„° ë§¤í•‘ ë° ì„±ëŠ¥ ìµœì í™”

### 2. í† í° ìƒëª…ì£¼ê¸° ê´€ë¦¬

- ë§Œë£Œ í† í° ìë™ ì •ë¦¬
- ë””ë°”ì´ìŠ¤ë³„ í† í° ê´€ë¦¬
- ë‹¤ì¤‘ ì„¸ì…˜ ì§€ì› ë° ì œí•œ

### 3. ë³´ì•ˆ ê°•í™”

- í† í° ê²€ì¦ ì—ëŸ¬ ìƒì„¸ ë¶„ë¥˜
- ê³µê°œ/ë¹„ê³µê°œ API ìœ ì—°í•œ ê´€ë¦¬
- ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ ì•ˆì „í•œ ì£¼ì…

## ğŸš€ ì™„ë£Œëœ ì „ì²´ ê¸°ëŠ¥ í˜„í™©

### ğŸ” **ì¸ì¦ ì‹œìŠ¤í…œ**

- âœ… JWT Access Token / Refresh Token ë¶„ë¦¬ ê´€ë¦¬
- âœ… í† í° ê²€ì¦ ë° ì‚¬ìš©ì ì¸ì¦
- âœ… í† í° ê°±ì‹  ë° ë§Œë£Œ ì²˜ë¦¬
- âœ… ë‹¤ì¤‘ ë””ë°”ì´ìŠ¤ ë¡œê·¸ì¸ ì§€ì›

### ğŸ‘¤ **ì‚¬ìš©ì ê´€ë¦¬**

- âœ… ì‚¬ìš©ì CRUD operations
- âœ… ì´ë©”ì¼ ì¸ì¦ ë° ìƒíƒœ ê´€ë¦¬
- âœ… ê³„ì • í™œì„±í™”/ë¹„í™œì„±í™”
- âœ… ì‚¬ìš©ì í†µê³„ ë° ê²€ìƒ‰

### ğŸŒ **ì†Œì…œ ë¡œê·¸ì¸**

- âœ… Google OAuth 2.0 ì—°ë™
- âœ… Apple Sign In ì—°ë™
- âœ… ì†Œì…œ ê³„ì • ì—°ê²°/í•´ì œ
- âœ… ê°œë°œ ëª¨ë“œ ëª©ì—… ì§€ì›

### ğŸ“§ **ì´ë©”ì¼ ì‹œìŠ¤í…œ**

- âœ… ë‹¤ì–‘í•œ ì´ë©”ì¼ í…œí”Œë¦¿ ì§€ì›
- âœ… ê°œë°œ/í”„ë¡œë•ì…˜ í™˜ê²½ ë¶„ë¦¬
- âœ… HTML í…œí”Œë¦¿ ê¸°ë°˜ ì´ë©”ì¼
- âœ… ë³´ì•ˆ ì•Œë¦¼ ë° ë¡œê·¸ì¸ ì•Œë¦¼

### ğŸ›¡ï¸ **ë³´ì•ˆ ê³„ì¸µ**

- âœ… JWT ì¸ì¦ ê°€ë“œ
- âœ… ë¦¬í”„ë ˆì‹œ í† í° ê°€ë“œ
- âœ… ì„ íƒì  ì¸ì¦ ê°€ë“œ
- âœ… ê³µê°œ API ì§€ì›

## ğŸ” ì½”ë“œ í’ˆì§ˆ ê°œì„ ì‚¬í•­

### 1. Linter ì¤€ìˆ˜ ë° ì½”ë“œ ìŠ¤íƒ€ì¼

- ëª¨ë“  íŒŒì¼ì—ì„œ ì¼ê´€ëœ ì½”ë”© ìŠ¤íƒ€ì¼ ì ìš©
- TypeScript strict ëª¨ë“œ ì¤€ìˆ˜
- ëª…í™•í•œ íƒ€ì… ì •ì˜ ë° ì¸í„°í˜ì´ìŠ¤ í™œìš©

### 2. ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”

- êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ë° ìƒíƒœ ì½”ë“œ
- ë„ë©”ì¸ ì˜ˆì™¸ì™€ ì¸í”„ë¼ ì˜ˆì™¸ ë¶„ë¦¬
- ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ì§€ì›

### 3. í…ŒìŠ¤íŠ¸ ì¤€ë¹„

- ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ êµ¬í˜„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ìš©ì´ì„± í™•ë³´
- ëª©ì—… êµ¬í˜„ì²´ë¡œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì§€ì›
- í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ êµ¬ì¡° ì¤€ë¹„

## ğŸ“¦ í•„ìš”í•œ íŒ¨í‚¤ì§€ ì •ë¦¬

```json
{
	"dependencies": {
		"@nestjs/common": "^10.0.0",
		"@nestjs/config": "^3.0.0",
		"@nestjs/jwt": "^10.0.0",
		"@nestjs/typeorm": "^10.0.0",
		"typeorm": "^0.3.0",
		"class-validator": "^0.14.0",
		"class-transformer": "^0.5.0"
	},
	"devDependencies": {
		"@types/node": "^20.0.0"
	}
}
```

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„: Step 5 - í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ

êµ¬í˜„ ì˜ˆì •:

### 1. **ì»¨íŠ¸ë¡¤ëŸ¬ ê³„ì¸µ**

- `auth.controller.ts` - ì¸ì¦ API ì—”ë“œí¬ì¸íŠ¸
- `user.controller.ts` - ì‚¬ìš©ì ê´€ë¦¬ API
- `social-auth.controller.ts` - ì†Œì…œ ë¡œê·¸ì¸ API

### 2. **ìš”ì²­/ì‘ë‹µ DTO**

- ìš”ì²­ DTO (signup, login, refresh ë“±)
- ì‘ë‹µ DTO (ì‚¬ìš©ì ì •ë³´, í† í° ë“±)
- ìœ íš¨ì„± ê²€ì¦ ë° ë³€í™˜

### 3. **ì»¤ìŠ¤í…€ ë°ì½”ë ˆì´í„°**

- `@CurrentUser()` - í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì£¼ì…
- `@Public()` - ê³µê°œ API í‘œì‹œ
- `@Roles()` - ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´

### 4. **ì˜ˆì™¸ í•„í„°**

- ë„ë©”ì¸ ì˜ˆì™¸ â†’ HTTP ì‘ë‹µ ë³€í™˜
- ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
- ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ì—°ë™

### 5. **ì¸í„°ì…‰í„°**

- ì‘ë‹µ ë°ì´í„° ë³€í™˜ ë° ë˜í•‘
- ìš”ì²­/ì‘ë‹µ ë¡œê¹…
- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

## ğŸ’¡ Step 4ì—ì„œ ì–»ì€ êµí›ˆ

1. **ì¸í„°í˜ì´ìŠ¤ ì¼ì¹˜ì˜ ì¤‘ìš”ì„±**: ë„ë©”ì¸ ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ì˜ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ì •í™•í•œ ì¼ì¹˜ í•„ìš”
2. **ë„ë©”ì¸ ì—”í‹°í‹° ë©”ì„œë“œ í˜¸ì¶œ**: getter ë©”ì„œë“œëª… ì •í™•í•œ ì‚¬ìš© (isActive() vs getIsActive())
3. **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ vs ë°ì´í„° ë¡œì§**: ë§Œë£Œ í† í° ì¡°íšŒ ì‹œ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ë¯¸ì— ë§ëŠ” ì¡°ê±´ ì„¤ì •
4. **ê°œë°œ ê²½í—˜ ìµœì í™”**: ê°œë°œ í™˜ê²½ì—ì„œ ì™¸ë¶€ ì˜ì¡´ì„± ì—†ì´ ë™ì‘í•˜ëŠ” ëª©ì—… êµ¬í˜„
5. **ë³´ì•ˆ ê³„ì¸µ ì„¤ê³„**: ë‹¤ì–‘í•œ ì¸ì¦ ìš”êµ¬ì‚¬í•­ì„ ì§€ì›í•˜ëŠ” ìœ ì—°í•œ ê°€ë“œ ì‹œìŠ¤í…œ

## ğŸ”® í™•ì¥ ê³„íš

1. **ì¶”ê°€ ì†Œì…œ ë¡œê·¸ì¸**: GitHub, Facebook, Kakao ë“±
2. **ì´ë©”ì¼ ì„œë¹„ìŠ¤ ì—°ë™**: SendGrid, AWS SES, Mailgun ë“±
3. **ìºì‹± ê³„ì¸µ**: Redis ê¸°ë°˜ ì„¸ì…˜ ë° í† í° ìºì‹±
4. **ëª¨ë‹ˆí„°ë§**: ë¡œê·¸ ìˆ˜ì§‘ ë° ë©”íŠ¸ë¦­ ì¶”ì 
5. **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€**: ë‹¨ìœ„/í†µí•©/E2E í…ŒìŠ¤íŠ¸ ì™„ì„±

---

**Step 4 ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ êµ¬í˜„ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰**

- **ì´ êµ¬í˜„ íŒŒì¼**: 12ê°œ (ë¦¬í¬ì§€í† ë¦¬ 2ê°œ, ì™¸ë¶€ì„œë¹„ìŠ¤ 3ê°œ, ê°€ë“œ 3ê°œ, ì„¤ì • 1ê°œ, ëª¨ë“ˆ 1ê°œ, ì¸ë±ìŠ¤ 3ê°œ)
- **í•µì‹¬ ê¸°ëŠ¥**: ì™„ì „í•œ ë°ì´í„° ì˜ì†ì„±, ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™, ë³´ì•ˆ ê³„ì¸µ êµ¬ì¶•
- **ì•„í‚¤í…ì²˜ ì›ì¹™**: ì˜ì¡´ì„± ì—­ì „, ì¸í„°í˜ì´ìŠ¤ ë¶„ë¦¬, ë‹¨ì¼ ì±…ì„ ì¤€ìˆ˜
- **ë‹¤ìŒ ë‹¨ê³„**: Step 5 í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µìœ¼ë¡œ ì „ì²´ ì‹œìŠ¤í…œ ì™„ì„±



